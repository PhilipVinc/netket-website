<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>netket.sampler.metropolis_hastings &#8212; netket v2.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jumbo-style.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/all.min.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html"><span><img src="../../../_static/logonav.png"></span>
          NetKet</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../get_started.html">Get Started</a></li>
                <li><a href="../../../documentation.html">Documentation</a></li>
                <li><a href="../../../tutorials.html">Tutorials</a></li>
                <li><a href="../../../citing.html">Citing NetKet</a></li>
                <li><a href="../../../about.html">About</a></li>
                <li><a href="https://github.com/netket/netket"><i class="fab fa-github" aria-hidden="true"></i></a></li>
                <li><a href="https://twitter.com/NetKetOrg"><i class="fab fa-twitter" aria-hidden="true"></i></a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for netket.sampler.metropolis_hastings</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">_np</span>
<span class="kn">from</span> <span class="nn">.abstract_sampler</span> <span class="k">import</span> <span class="n">AbstractSampler</span>

<span class="kn">from</span> <span class="nn">.._C_netket</span> <span class="k">import</span> <span class="n">sampler</span> <span class="k">as</span> <span class="n">c_sampler</span>
<span class="kn">from</span> <span class="nn">.._C_netket.utils</span> <span class="k">import</span> <span class="n">random_engine</span><span class="p">,</span> <span class="n">rand_uniform_real</span>


<span class="k">class</span> <span class="nc">PyMetropolisHastings</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ``MetropolisHastings`` is a generic Metropolis-Hastings sampler using</span>
<span class="sd">    a local transition kernel to perform moves in the Markov Chain.</span>
<span class="sd">    The transition kernel is used to generate</span>
<span class="sd">    a proposed state :math:`s^\prime`, starting from the current state :math:`s`.</span>
<span class="sd">    The move is accepted with probability</span>

<span class="sd">    .. math::</span>
<span class="sd">    A(s\rightarrow s^\prime) = \mathrm{min}\left (1,\frac{P(s^\prime)}{P(s)} F(e^{L(s,s^\prime)})\right),</span>

<span class="sd">    where the probability being sampled is :math:`F(\Psi(s))` (by default :math:`F(x)=|x|^2`)</span>
<span class="sd">    and :math:`L(s,s^\prime)` is a correcting factor computed by the transition kernel.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">transition_kernel</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a new ``MetropolisHastings`` sampler given a machine and</span>
<span class="sd">        a transition kernel.</span>

<span class="sd">        Args:</span>
<span class="sd">            machine: A machine :math:`\Psi(s)` used for the sampling.</span>
<span class="sd">                          The probability distribution being sampled</span>
<span class="sd">                          from is :math:`F(\Psi(s))`, where the function</span>
<span class="sd">                          $$F(X)$$, is arbitrary, by default :math:`F(X)=|X|^2`.</span>
<span class="sd">            transition_kernel: A function to generate a transition.</span>
<span class="sd">                          This should take as an input the current state (in batches)</span>
<span class="sd">                          and return a modified state (also in batches).</span>
<span class="sd">                          This function must also return an array containing the</span>
<span class="sd">                          `log_prob_corrections` :math:`L(s,s^\prime)`.</span>
<span class="sd">            n_chains: The number of Markov Chain to be run in parallel on a single process.</span>
<span class="sd">            sweep_size: The number of exchanges that compose a single sweep.</span>
<span class="sd">                        If None, sweep_size is equal to the number of degrees of freedom (n_visible).</span>
<span class="sd">            batch_size: The batch size to be used when calling log_val on the given Machine.</span>
<span class="sd">                        If None, batch_size is equal to the number Markov chains (n_chains).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">machine</span> <span class="o">=</span> <span class="n">machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span> <span class="o">=</span> <span class="n">n_chains</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_size</span> <span class="o">=</span> <span class="n">sweep_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span> <span class="o">=</span> <span class="n">transition_kernel</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="n">_np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span>
            <span class="n">_np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chains</span>

    <span class="nd">@n_chains</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">n_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n_chains</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a positive integer for n_chains &quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_n_chains</span> <span class="o">=</span> <span class="n">n_chains</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_chains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_visible</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_values</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_values_1</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_corr</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_chains</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_fun</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_func</span> <span class="o">=</span> <span class="n">machine_fun</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sweep_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_size</span>

    <span class="nd">@sweep_size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sweep_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweep_size</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_size</span> <span class="o">=</span> <span class="n">sweep_size</span> <span class="k">if</span> <span class="n">sweep_size</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_visible</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected a positive integer for sweep_size &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rand_for_acceptance</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sweep_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_chains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>

    <span class="nd">@machine</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_visible</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">hilbert</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hilbert</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">hilbert</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">init_random</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hilbert</span><span class="o">.</span><span class="n">random_vals</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">random_engine</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">log_val</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_val_batched</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine</span><span class="o">.</span><span class="n">log_val</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rand_uniform_real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rand_for_acceptance</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_size</span><span class="p">):</span>

            <span class="c1"># Propose a new state using the transition kernel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_kernel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_corr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_log_values_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_val_batched</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state1</span><span class="p">)</span>

            <span class="c1"># Acceptance probability</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_func</span><span class="p">(</span>
                <span class="n">_np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_values_1</span> <span class="o">-</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_values</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_prob_corr</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Acceptance test</span>
            <span class="n">accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rand_for_acceptance</span><span class="p">[</span><span class="n">sweep</span><span class="p">]</span>

            <span class="c1"># Update of the state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_values</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">accept</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_values_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">_np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">accept</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>


<div class="viewcode-block" id="MetropolisLocal"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisLocal.html#netket.sampler.MetropolisLocal">[docs]</a><span class="k">class</span> <span class="nc">MetropolisLocal</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sampler acting on one local degree of freedom.</span>

<span class="sd">    This sampler acts locally only on one local degree of freedom :math:`s_i`,</span>
<span class="sd">    and proposes a new state: :math:`s_1 \dots s^\prime_i \dots s_N`,</span>
<span class="sd">    where :math:`s^\prime_i \\neq s_i`.</span>

<span class="sd">    The transition probability associated to this</span>
<span class="sd">    sampler can be decomposed into two steps:</span>

<span class="sd">    1. One of the site indices :math:`i = 1\dots N` is chosen</span>
<span class="sd">    with uniform probability.</span>
<span class="sd">    2. Among all the possible (:math:`m`) values that :math:`s_i` can take,</span>
<span class="sd">    one of them is chosen with uniform probability.</span>

<span class="sd">    For example, in the case of spin :math:`1/2` particles, :math:`m=2`</span>
<span class="sd">    and the possible local values are :math:`s_i = -1,+1`.</span>
<span class="sd">    In this case then :class:`MetropolisLocal` is equivalent to flipping a random spin.</span>

<span class="sd">    In the case of bosons, with occupation numbers</span>
<span class="sd">    :math:`s_i = 0, 1, \dots n_{\mathrm{max}}`, :class:`MetropolisLocal`</span>
<span class="sd">    would pick a random local occupation number uniformly between :math:`0`</span>
<span class="sd">    and :math:`n_{\mathrm{max}}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetropolisLocal.__init__"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisLocal.html#netket.sampler.MetropolisLocal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         Constructs a new :class:`MetropolisLocal` sampler given a machine.</span>

<span class="sd">         Args:</span>
<span class="sd">            machine: A machine :math:`\Psi(s)` used for the sampling.</span>
<span class="sd">                     The probability distribution being sampled</span>
<span class="sd">                     from is :math:`F(\Psi(s))`, where the function</span>
<span class="sd">                     :math:`F(X)`, is arbitrary, by default :math:`F(X)=|X|^2`.</span>

<span class="sd">            n_chains:   The number of Markov Chain to be run in parallel on a single process.</span>
<span class="sd">            sweep_size: The number of exchanges that compose a single sweep.</span>
<span class="sd">                        If None, sweep_size is equal to the number of degrees of freedom (n_visible).</span>
<span class="sd">            batch_size: The batch size to be used when calling log_val on the given Machine.</span>
<span class="sd">                        If None, batch_size is equal to the number Markov chains (n_chains).</span>


<span class="sd">         Examples:</span>
<span class="sd">             Sampling from a RBM machine in a 1D lattice of spin 1/2</span>

<span class="sd">             &gt;&gt;&gt; import netket as nk</span>
<span class="sd">             &gt;&gt;&gt;</span>
<span class="sd">             &gt;&gt;&gt; g=nk.graph.Hypercube(length=10,n_dim=2,pbc=True)</span>
<span class="sd">             &gt;&gt;&gt; hi=nk.hilbert.Spin(s=0.5,graph=g)</span>
<span class="sd">             &gt;&gt;&gt;</span>
<span class="sd">             &gt;&gt;&gt; # RBM Spin Machine</span>
<span class="sd">             &gt;&gt;&gt; ma = nk.machine.RbmSpin(alpha=1, hilbert=hi)</span>
<span class="sd">             &gt;&gt;&gt;</span>
<span class="sd">             &gt;&gt;&gt; # Construct a MetropolisLocal Sampler</span>
<span class="sd">             &gt;&gt;&gt; sa = nk.sampler.MetropolisLocal(machine=ma)</span>
<span class="sd">             &gt;&gt;&gt; print(sa.machine.hilbert.size)</span>
<span class="sd">             100</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisLocal</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">n_chains</span><span class="o">=</span><span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">PyMetropolisHastings</span><span class="p">(</span>
                <span class="n">machine</span><span class="p">,</span>
                <span class="n">c_sampler</span><span class="o">.</span><span class="n">LocalKernel</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">hilbert</span><span class="p">),</span>
                <span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span></div>


<div class="viewcode-block" id="MetropolisLocalPt"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisLocalPt.html#netket.sampler.MetropolisLocalPt">[docs]</a><span class="k">class</span> <span class="nc">MetropolisLocalPt</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetropolisLocalPt.__init__"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisLocalPt.html#netket.sampler.MetropolisLocalPt.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">n_replicas</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisLocalPt</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_replicas</span><span class="o">=</span><span class="n">n_replicas</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Parallel Tempering samplers are not yet implemented</span>
<span class="sd">                for pure python machines&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span></div>


<div class="viewcode-block" id="MetropolisExchange"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisExchange.html#netket.sampler.MetropolisExchange">[docs]</a><span class="k">class</span> <span class="nc">MetropolisExchange</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetropolisExchange.__init__"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisExchange.html#netket.sampler.MetropolisExchange.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisExchange</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">n_chains</span><span class="o">=</span><span class="n">n_chains</span><span class="p">,</span>
                <span class="n">d_max</span><span class="o">=</span><span class="n">d_max</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">PyMetropolisHastings</span><span class="p">(</span>
                <span class="n">machine</span><span class="p">,</span>
                <span class="n">c_sampler</span><span class="o">.</span><span class="n">ExchangeKernel</span><span class="p">(</span><span class="n">machine</span><span class="o">.</span><span class="n">hilbert</span><span class="p">,</span> <span class="n">d_max</span><span class="p">),</span>
                <span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span></div>


<div class="viewcode-block" id="MetropolisExchangePt"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisExchangePt.html#netket.sampler.MetropolisExchangePt">[docs]</a><span class="k">class</span> <span class="nc">MetropolisExchangePt</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetropolisExchangePt.__init__"><a class="viewcode-back" href="../../../modules/netket.sampler.MetropolisExchangePt.html#netket.sampler.MetropolisExchangePt.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">d_max</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_replicas</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisExchangePt</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">n_replicas</span><span class="o">=</span><span class="n">n_replicas</span><span class="p">,</span>
                <span class="n">d_max</span><span class="o">=</span><span class="n">d_max</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Parallel Tempering samplers are not yet implemented</span>
<span class="sd">                for pure python machines&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span></div>


<span class="k">class</span> <span class="nc">MetropolisHamiltonian</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="p">,</span> <span class="n">n_chains</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisHamiltonian</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">hamiltonian</span><span class="o">=</span><span class="n">hamiltonian</span><span class="p">,</span>
                <span class="n">n_chains</span><span class="o">=</span><span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">PyMetropolisHastings</span><span class="p">(</span>
                <span class="n">machine</span><span class="p">,</span>
                <span class="n">c_sampler</span><span class="o">.</span><span class="n">HamiltonianKernel</span><span class="p">(</span><span class="n">hamiltonian</span><span class="p">),</span>
                <span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">MetropolisHamiltonianPt</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="p">,</span> <span class="n">n_replicas</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">MetropolisHamiltonianPt</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">hamiltonian</span><span class="o">=</span><span class="n">hamiltonian</span><span class="p">,</span>
                <span class="n">n_replicas</span><span class="o">=</span><span class="n">n_replicas</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Parallel Tempering samplers are not yet implemented</span>
<span class="sd">                for pure python machines&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">CustomSampler</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">machine</span><span class="p">,</span>
        <span class="n">move_operators</span><span class="p">,</span>
        <span class="n">move_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_chains</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
        <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">CustomSampler</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">move_operators</span><span class="o">=</span><span class="n">move_operators</span><span class="p">,</span>
                <span class="n">move_weights</span><span class="o">=</span><span class="n">move_weights</span><span class="p">,</span>
                <span class="n">n_chains</span><span class="o">=</span><span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">PyMetropolisHastings</span><span class="p">(</span>
                <span class="n">machine</span><span class="p">,</span>
                <span class="n">c_sampler</span><span class="o">.</span><span class="n">CustomLocalKernel</span><span class="p">(</span><span class="n">move_operators</span><span class="p">,</span> <span class="n">move_weights</span><span class="p">),</span>
                <span class="n">n_chains</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="p">,</span>
                <span class="n">batch_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="n">n_chains</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">CustomSamplerPt</span><span class="p">(</span><span class="n">AbstractSampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">machine</span><span class="p">,</span> <span class="n">move_operators</span><span class="p">,</span> <span class="n">move_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_replicas</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">sweep_size</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;_C_netket.machine&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">machine</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">c_sampler</span><span class="o">.</span><span class="n">CustomSamplerPt</span><span class="p">(</span>
                <span class="n">machine</span><span class="o">=</span><span class="n">machine</span><span class="p">,</span>
                <span class="n">move_operators</span><span class="o">=</span><span class="n">move_operators</span><span class="p">,</span>
                <span class="n">move_weights</span><span class="o">=</span><span class="n">move_weights</span><span class="p">,</span>
                <span class="n">n_replicas</span><span class="o">=</span><span class="n">n_replicas</span><span class="p">,</span>
                <span class="n">sweep_size</span><span class="o">=</span><span class="n">sweep_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Parallel Tempering samplers are not yet implemented</span>
<span class="sd">                            for pure python machines&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">machine</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_random</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">init_random</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="fm">__next__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span>

    <span class="nd">@machine_func</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">machine_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">machine_func</span> <span class="o">=</span> <span class="n">func</span>
</pre></div>

    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, The Simons Foundation, Inc. - All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.<br/>
    </p>
  </div>
</footer>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118013987-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-118013987-1');
</script>

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "url": "https://www.netket.org",
  "name": "NetKet",
  "founder": "Giuseppe Carleo",
  "foundingDate": "2018-04-24",
  "foundingLocation" : "New York",
  "logo": "https://www.netket.org/img/logo_small.jpg",
  "sameAs": [
    "https://twitter.com/NetKetOrg",
    "https://github.com/NetKet/netket"
  ],
  "description" : "Netket is an open-source project delivering cutting-edge
  methods for the study of many-body quantum systems with artificial neural
  networks and machine learning techniques.
  NetKet provides state-of-the-art Neural-Network Quantum states,
  and advanced learning algorithms to find the ground-state of many-body Hamiltonians.
 NetKet is supported by the Simons Foundation and the Flatiron Institute."
}
</script>

  </body>
</html>